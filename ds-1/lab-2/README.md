# Лабораторная работа 2. Разработка модуля справочной информации бизнес-приложения
## Шаг 1. Справочники
В моей работе используются справочники "Музыкальные артисты" и "Музыкальные альбомы".
Структура представлена в таблицах:

Музыкальные альбомы: 

| Поле                      | Тип данных            | Описание                                 |
|---------------------------|-----------------------|------------------------------------------|
| Идентификатор             | Целое число           | Уникальный идентификатор альбома         |
| Название                  | Текстовая строка      | Название музыкального альбома            |
| Идентификатор исполнителя | Целое число           | Имя или название исполнителя             |
| Жанр                      | Текстовая строка      | Жанр музыки, к которому относится альбом |
| Год выпуска               | Дата                  | Год выпуска альбома                      |
| Продолжительность         | Число с фикс. запятой | Продолжительность альбома в минутах      |

Музыкальные исполнители:

| Поле               | Тип данных       | Описание                                  |
|--------------------|------------------|-------------------------------------------|
| Идентификатор      | Целое число      | Уникальный идентификатор исполнителя      |
| Имя                | Текстовая строка | Имя или название исполнителя              |
| Страна             | Текстовая строка | Страна происхождения исполнителя          |
| Год начала карьеры | Дата             | Год образования группы или начала карьеры |
| Жанр               | Текстовая строка | Основной жанр музыки, который исполняет   |

Связь справочников представлена связью Исполнитель (идентификатор) - Альбом (идентификатор исполнителя).


## Шаг 2. Создание и заполнение БД.

![img_3.png](images/img_3.png)

Для дальнейшей работы будет использоваться СУБД Postgesql. Образ данной СУБД поднимается в Docker-контейнере с помощью
утилиты docker-compose. 

Код для создания таблиц представлен в файле [init.sql](sql%2Finit.sql). 

В результате заполнения таблиц получим следующее:
![img_1.png](images/img_1.png)
![img_2.png](images/img_2.png)

## Шаг 3. Разработка приложения
Для работы я выбрала фреймворк Flask (Python). С помощью него возможно быстро построить простой web-приложение.

### Интерфейс:
- Просмотр и выбор справочника:
![img_5.png](images/img_5.png)

- Просмотр данных справочника: 
[img_6.png](images/img_6.png)

- Добавление записи: 
![img_7.png](images/img_7.png)
Добавлена валидация дат, чисел и тп.
![img_8.png](images/img_8.png)

- Редактирование записи: 
![img_9.png](images/img_9.png)

- Удаление записи:
![img_10.png](images/img_10.png)

Отмечу, что все foreign keys также отображаются в таблицах, причем не просто id,
на который ссылается запись, а на осмысленное имя: 
![img_11.png](images/img_11.png)

При редактировании и добавлении новой записи для foreign key отображается список из
доступных вариантов: 
![img_12.png](images/img_12.png)


## Шаг 4. Бонус!
Архитектура данного приложения построена так, что код работает с любой таблицей и не 
зависит от конкретной реализации таблицы.

Для этого я использую некоторые таблицы с метаданными из Postgres, а также собственную таблицу
`table_names_aliases`.
![img_13.png](images/img_13.png)

В коде эта таблица используется в качестве словаря для "алиасов": id я заменяю на осознанные названия.

Также я создала несколько view для отслеживания зависимостей между таблицами. Именно на этих вью
и построена вся логика правильного отображения всех полей для таблиц, где есть foreign key.

Для тестирования я создала ещё одну таблицу `music_awards`:
![img_14.png](images/img_14.png)

И внесла доп. запись в таблицу 
`table_names_aliases`.

Теперь на главной странице отображается и эта таблица, ~~без мам, пап и кредитов~~ без изменений кода приложения. 
Можно делать всё то же самое, что и с первыми двумя.
![img_15.png](images/img_15.png)
![img_16.png](images/img_16.png)


## Запуск приложения
Для удобства написан Makefile.
Для запуска сервера:
 ```bash
 make run-web
 ```
Для запуска Postgresql:
 ```bash
 make run-db
 ```
Для добавления доп. таблицы:
```bash
add-sql
```
Для остановки:
 ```bash
 make stop
 ```
Очистка volumes:
 ```bash
 make clean-volumes
 ```

